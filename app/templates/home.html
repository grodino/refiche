{% extends "base.html" %}
{% load static app_extras admin_urls %}

{% block add_js %}
    {{ block.super }}
    <script src="{% static 'js/sheets_feed.js' %}"></script>
{% endblock %}

{% block add_stylesheets %}
<link rel="stylesheet" href="{% static 'css/app.css' %}" />
{% endblock %}

{% block header-nolink %}
    <div class="nav-icon">
        <div></div>
    </div>
{% endblock %}

{% block hidden %}
    {% include 'loading.html' %}
{% endblock %}

{% block left-bar %}
    <header id="left-bar-header">
        <h3>Dernières fiches</h3>
    </header>

    <div id="feed">
        Chargement ...
    </div>
{% endblock %}

{% block content %}
<nav class="container">
    <div class="row">
        <div id="user_infos" class="six columns left-cell full-container-size">
            <div id="user_infos_content" class="full-container-size">
                <a href="#" class="full-container-size">
                    <img id="user-icon" src="{% if student.avatar %}
                                                {% url 'app.views.downloadRessource' ressource='avatars' url=student.avatar.name|cut:'avatars/' %}
                                             {% else %}
                                                {% static 'img/icons/default_avatar.png' %}
                                             {% endif %}" />

                    <div>{{ user.first_name }} {{ user.last_name|upper }}</div>
                </a>
            </div>

            <div id="user_options" class="full-container-size">
                <div class="full-container-size" style="background-image: url('{% static 'img/icons/settings.png' %}');">
                    <h5>Options</h5>

                    {% if request.user.is_staff %}
                    <div>
                        <a id="add_lesson" href="{% url 'admin:index' %}">Administration</a>
                    </div>

                    <div>
                        <a id="get_code" href="#">Code d'inscription</a>
                    </div>
                    {% endif %}

                    <div>
                        <a href="{% url 'app.views.accountPage' %}">Mon compte</a>
                    </div>

                    <div>
                        <a href="{% url 'django.contrib.auth.views.logout' %}">Déconnexion</a>
                    </div>
                </div>
            </div>

            {% if request.user.is_staff %}
                <div id="new_code_form" class="new_form">
                    {% load registration_extras %}
                    {% getStudentRegistrationForm request %}
                </div>

                <div id="new_code_form_success" class="full-container-size">
                    <div class="full-container-size">
                        <h5>Votre code : </h5>
                        <input type="text" readonly="true" value="{{ code }}">
                        <a href="#" id="hide_new_code_success">RETOUR</a>
                    </div>
                </div>
            {% endif %}
        </div>
        
        <div id="left_cell" class="six columns">
            <div class="container">
                <div id="classroom_profile" class="row right-cell"><a href="{% url 'app.views.classroomPage' %}" class="full-container-size"><h5>{{ student.classroom.name }}</h5></a></div>
                <div class="row right-cell" id="new_sheet_div" >
                    <a id="post_new_sheet_link" href="#" class="full-container-size post_new_sheet_link"><h5>Poster une nouvelle fiche !</h5></a>
                </div>
            </div>
        </div>
    </div>
</nav>

<div id="new_sheet_form" class="new_form">
    <h5>Poster une nouvelle fiche ! <a id="hide_new_sheet_form" class="u-pull-right">Retour</a></h5>
    {% getNewSheetForm request %}
</div>

{% block in_content %}
<div id="lessons">
    <header>
        <h3>Matières</h3>
    </header>
    
    <div class="flex-container">
        {% for lesson in lessons %}
        <div class="lesson">
            <a class="full-container-size" href="{% url 'app.views.lessonPage' lesson_name=lesson.name %}">
                <div class="name_container">
                    <h5>{{ lesson.name }}</h5>
                    <p>
                        {{ lesson.teacher.gender }}
                        {{ lesson.teacher.lastName }}
                    </p>
                </div>

                <div class="info_container">
                    <h5>Derniers partages:</h5>

                    {% for item in lesson.getLastItems %}
                        {% if item.name %}
                            {% with item as sheet %}
                                <div class="end-line-wrap">{{ sheet.name }}</div>
                            {% endwith %}
                        {% endif %}

                        {% if item.webSiteName %}
                            {% with item as link %}
                                <div class="end-line-wrap">{{ link.webSiteName }}</div>
                            {% endwith %}
                        {% endif %}
                    {% empty %}
                        Arghh aucun partage récent :'(
                    {% endfor %}
                </div>
            </a> 
        </div>
        {% empty %}
            <div class="full-container-size">
                <h5>Vous n'avez pas encore de matière :(</h5>
                <p>Demandez à votre délégué de les créer !</p>
            </div>
        {% endfor %}
    </div>
</div>

{% endblock %}
{% endblock %}